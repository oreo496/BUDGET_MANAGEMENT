================================================================================
                    FUNDER - BUDGET MANAGEMENT SYSTEM
                          COMPREHENSIVE UML DIAGRAM
================================================================================

@startuml Funder_System_Architecture

' ============================================================================
'                            SYSTEM OVERVIEW
' ============================================================================

package "Frontend Layer (Next.js/React)" {
    component [Login Page] as Login
    component [Registration Page] as Register
    component [Dashboard] as Dashboard
    component [Transactions Page] as TransPage
    component [Budgets Page] as BudgetPage
    component [Goals Page] as GoalPage
    component [Loans Page] as LoanPage
    component [Admin Panel] as AdminPanel
    component [AI Insights] as AIInsights
    component [Bank Connection] as BankConn
    component [Chatbot Interface] as Chatbot
}

package "API Gateway" {
    component [API Router] as APIRouter
    component [JWT Authentication] as JWTAuth
    component [CORS Middleware] as CORS
}

package "Backend Layer (Django REST Framework)" {
    
    package "Apps" {
        component [Accounts App] as AccountsApp
        component [Transactions App] as TransApp
        component [Budgets App] as BudgetsApp
        component [Goals App] as GoalsApp
        component [Loans App] as LoansApp
        component [Categories App] as CategoriesApp
        component [Bank Accounts App] as BankApp
        component [AI Alerts App] as AIApp
        component [Admin Panel App] as AdminApp
        component [Chatbot App] as ChatbotApp
        component [Funder App] as FunderApp
    }
    
    package "Design Patterns" {
        component [Observer Pattern] as Observer
        component [Strategy Pattern] as Strategy
        component [Event Dispatcher] as EventDispatcher
        component [Singleton Cache] as Singleton
    }
    
    package "Utils" {
        component [Authentication Strategies] as AuthStrategies
        component [Calculation Strategies] as CalcStrategies
        component [Event System] as EventSystem
    }
}

package "AI/ML Layer" {
    component [PyTorch DNN Model] as DNN
    component [ResNet Model] as ResNet
    component [Attention Network] as Attention
    component [TabNet Model] as TabNet
    component [Model Loader] as ModelLoader
    component [Prediction Engine] as PredEngine
}

package "External Services" {
    component [Plaid API] as PlaidAPI
    component [Bank Integration] as BankInteg
}

database "MySQL Database" {
    storage [users] as UsersDB
    storage [admins] as AdminsDB
    storage [transactions] as TransDB
    storage [budgets] as BudgetsDB
    storage [goals] as GoalsDB
    storage [loans] as LoansDB
    storage [categories] as CategoriesDB
    storage [bank_accounts] as BankAccountsDB
    storage [ai_alerts] as AIAlertsDB
    storage [system_logs] as LogsDB
}

' Connections
Login --> APIRouter
Register --> APIRouter
Dashboard --> APIRouter
TransPage --> APIRouter
BudgetPage --> APIRouter
GoalPage --> APIRouter
LoanPage --> APIRouter
AdminPanel --> APIRouter
AIInsights --> APIRouter
BankConn --> APIRouter
Chatbot --> APIRouter

APIRouter --> JWTAuth
APIRouter --> CORS
JWTAuth --> AccountsApp

AccountsApp --> UsersDB
AccountsApp --> AdminsDB
TransApp --> TransDB
BudgetsApp --> BudgetsDB
GoalsApp --> GoalsDB
LoansApp --> LoansDB
CategoriesApp --> CategoriesDB
BankApp --> BankAccountsDB
AIApp --> AIAlertsDB
AdminApp --> LogsDB

TransApp --> Observer
BudgetsApp --> Strategy
LoansApp --> Strategy
TransApp --> EventDispatcher
BudgetsApp --> EventDispatcher

AIApp --> ModelLoader
ModelLoader --> DNN
ModelLoader --> ResNet
ModelLoader --> Attention
ModelLoader --> TabNet
ModelLoader --> PredEngine

BankApp --> PlaidAPI
PlaidAPI --> BankInteg

@enduml


' ============================================================================
'                         DATABASE MODELS (CLASS DIAGRAM)
' ============================================================================

@startuml Database_Models

' ===== User and Admin Models =====

class User {
    - id: UUID (PK)
    - username: CharField(50) [UNIQUE]
    - first_name: CharField(50)
    - last_name: CharField(50)
    - email: EmailField [UNIQUE]
    - password_hash: CharField(255)
    - phone: CharField(20) [NULL]
    - status: CharField(10) ['ACTIVE', 'INACTIVE']
    - created_at: DateTimeField
    --
    + set_password(raw_password)
    + check_password(raw_password): bool
    + get_uuid_string(): str
    + is_authenticated: bool
    + is_active: bool
    + is_anonymous: bool
}

class Admin {
    - id: UUID (PK)
    - email: EmailField [UNIQUE]
    - password_hash: CharField(255)
    - created_at: DateTimeField
    --
    + set_password(raw_password)
    + check_password(raw_password): bool
    + get_uuid_string(): str
}

' ===== Financial Models =====

class Transaction {
    - id: UUID (PK)
    - user_id: UUID (FK -> User)
    - category_id: UUID (FK -> Category) [NULL]
    - bank_account_id: UUID (FK -> BankAccount) [NULL]
    - amount: Decimal(10,2)
    - type: CharField(10) ['INCOME', 'EXPENSE']
    - description: CharField(255) [NULL]
    - merchant: CharField(255) [NULL]
    - date: DateField
    - source: CharField(10) ['MANUAL', 'SYNCED']
    - plaid_transaction_id: CharField(100) [UNIQUE, NULL]
    - flagged_fraud: BooleanField
    - created_at: DateTimeField
    --
    + get_uuid_string(): str
}

class Budget {
    - id: BinaryField(16) (PK)
    - user_id: UUID (FK -> User)
    - category_id: UUID (FK -> Category)
    - period: CharField(10) ['WEEKLY', 'MONTHLY']
    - amount: Decimal(10,2)
    - created_at: DateTimeField
    --
    + get_uuid_string(): str
    + calculate_period_amount(target_period): Decimal
    + get_spending_status(): dict
}

class Goal {
    - id: UUID (PK)
    - user_id: UUID (FK -> User)
    - title: CharField(100)
    - target_amount: Decimal(10,2)
    - current_amount: Decimal(10,2)
    - deadline: DateField [NULL]
    - created_at: DateTimeField
    --
    + get_uuid_string(): str
    + progress_percentage: float
}

class Loan {
    - id: UUID (PK)
    - user_id: UUID (FK -> User)
    - lender_name: CharField(100)
    - amount: Decimal(12,2)
    - term_months: IntegerField
    - interest_rate: Decimal(5,2)
    - status: CharField(12) ['PENDING', 'APPROVED', 'REJECTED']
    - created_at: DateTimeField
    --
    + get_uuid_string(): str
    + calculate_interest(calculation_type): Decimal
    + calculate_monthly_payment(): Decimal
    + get_loan_summary(): dict
}

class Category {
    - id: BinaryField(16) (PK)
    - user_id: UUID (FK -> User)
    - name: CharField(50)
    - type: CharField(10) ['INCOME', 'EXPENSE']
    - created_at: DateTimeField
    --
    + get_uuid_string(): str
}

class BankAccount {
    - id: UUID (PK)
    - user_id: UUID (FK -> User)
    - institution_name: CharField(100) [NULL]
    - account_type: CharField(50) [NULL]
    - token: BinaryField(500) [ENCRYPTED]
    - plaid_access_token: BinaryField(500) [ENCRYPTED, NULL]
    - plaid_item_id: CharField(100) [NULL]
    - plaid_account_id: CharField(100) [NULL]
    - plaid_cursor: TextField [NULL]
    - last_sync: DateTimeField [NULL]
    - auto_sync_enabled: BooleanField
    - created_at: DateTimeField
    --
    + get_uuid_string(): str
    + encrypt_token(plain_token)
    + decrypt_token(): str
    + encrypt_plaid_token(plain_token)
    + decrypt_plaid_token(): str
}

class AIAlert {
    - id: BinaryField(16) (PK)
    - user_id: UUID (FK -> User)
    - message: TextField
    - type: CharField(30) ['BUDGET_ALERT', 'SPENDING_PATTERN', 'FRAUD', 'GOAL_RECOMMENDATION', 'LOAN_REMINDER', 'GOAL_RISK']
    - created_at: DateTimeField
    --
    + get_uuid_string(): str
}

' ===== Admin Models =====

class SystemLog {
    - id: BinaryField(16) (PK)
    - user_id: UUID (FK -> User) [NULL]
    - admin_id: UUID (FK -> Admin) [NULL]
    - action: CharField(255)
    - details: TextField [NULL]
    - timestamp: DateTimeField
    --
    + get_uuid_string(): str
}

class AdminAction {
    - id: BinaryField(16) (PK)
    - admin_id: UUID (FK -> Admin)
    - action: CharField(255)
    - target_user_id: UUID (FK -> User) [NULL]
    - transaction_id: UUID (FK -> Transaction) [NULL]
    - timestamp: DateTimeField
    --
    + get_uuid_string(): str
}

' ===== Relationships =====

User "1" --> "0..*" Transaction : creates
User "1" --> "0..*" Budget : manages
User "1" --> "0..*" Goal : sets
User "1" --> "0..*" Loan : applies
User "1" --> "0..*" Category : defines
User "1" --> "0..*" BankAccount : owns
User "1" --> "0..*" AIAlert : receives
User "1" --> "0..*" SystemLog : actions logged

Admin "1" --> "0..*" SystemLog : performs
Admin "1" --> "0..*" AdminAction : executes

Category "1" --> "0..*" Transaction : categorizes
Category "1" --> "0..*" Budget : tracks

BankAccount "1" --> "0..*" Transaction : sources

@enduml


' ============================================================================
'                      DESIGN PATTERNS IMPLEMENTATION
' ============================================================================

@startuml Design_Patterns

' ===== Observer Pattern =====

package "Observer Pattern" {
    
    interface Observer {
        + update(event_type: str, data: dict)
    }
    
    class EventDispatcher {
        - observers: dict
        --
        + register(event_type: str, observer: Observer)
        + unregister(event_type: str, observer: Observer)
        + dispatch(event_type: str, data: dict)
    }
    
    class TransactionCategorizationObserver {
        + update(event_type: str, data: dict)
        - categorize_transaction(transaction)
    }
    
    class FraudDetectionObserver {
        + update(event_type: str, data: dict)
        - check_fraud(transaction)
    }
    
    class LargeTransactionObserver {
        + update(event_type: str, data: dict)
        - check_large_amount(transaction)
    }
    
    class BudgetObserver {
        + update(event_type: str, data: dict)
        - check_budget_status(user, category, amount)
    }
    
    Observer <|.. TransactionCategorizationObserver
    Observer <|.. FraudDetectionObserver
    Observer <|.. LargeTransactionObserver
    Observer <|.. BudgetObserver
    
    EventDispatcher "1" --> "0..*" Observer : notifies
}

' ===== Strategy Pattern =====

package "Strategy Pattern" {
    
    interface CalculationStrategy {
        + calculate(**kwargs): Decimal
    }
    
    class CalculationContext {
        - strategy: CalculationStrategy
        --
        + __init__(strategy: CalculationStrategy)
        + execute(**kwargs): Decimal
    }
    
    class SimpleInterestCalculation {
        + calculate(principal, rate, time_years): Decimal
        - formula: Interest = P * R * T
    }
    
    class CompoundInterestCalculation {
        + calculate(principal, rate, time_years, compounds_per_year): Decimal
        - formula: A = P(1 + r/n)^(nt) - P
    }
    
    class WeeklyBudgetCalculation {
        + calculate(monthly_amount): Decimal
        - formula: Weekly = Monthly * 12 / 52
    }
    
    class MonthlyBudgetCalculation {
        + calculate(weekly_amount): Decimal
        - formula: Monthly = Weekly * 52 / 12
    }
    
    CalculationStrategy <|.. SimpleInterestCalculation
    CalculationStrategy <|.. CompoundInterestCalculation
    CalculationStrategy <|.. WeeklyBudgetCalculation
    CalculationStrategy <|.. MonthlyBudgetCalculation
    
    CalculationContext "1" --> "1" CalculationStrategy : uses
}

' ===== Authentication Strategy Pattern =====

package "Authentication Strategy" {
    
    interface AuthenticationStrategy {
        + authenticate(identifier: str, password: str): User
    }
    
    class AuthenticationContext {
        - strategy: AuthenticationStrategy
        --
        + set_strategy(strategy: AuthenticationStrategy)
        + authenticate(identifier: str, password: str): User
    }
    
    class PasswordAuthenticationStrategy {
        + authenticate(identifier: str, password: str): User
        - verify_password(user, password): bool
    }
    
    AuthenticationStrategy <|.. PasswordAuthenticationStrategy
    AuthenticationContext "1" --> "1" AuthenticationStrategy : uses
}

' ===== Singleton Pattern =====

package "Singleton Pattern" {
    
    class PerformanceCache <<Singleton>> {
        - _instance: PerformanceCache
        - cache: dict
        --
        + get_instance(): PerformanceCache
        + get(key: str): Any
        + set(key: str, value: Any, ttl: int)
        + clear()
    }
}

@enduml


' ============================================================================
'                     AI/ML ARCHITECTURE
' ============================================================================

@startuml AI_ML_Architecture

package "AI Model Classes" {
    
    class DeepNeuralNetwork {
        - fc1: Linear(input_size, 128)
        - fc2: Linear(128, 64)
        - fc3: Linear(64, output_size)
        - relu: ReLU()
        - dropout: Dropout(0.3)
        --
        + forward(x): Tensor
    }
    
    class ResidualBlock {
        - fc1: Linear(hidden_size, hidden_size)
        - fc2: Linear(hidden_size, hidden_size)
        - relu: ReLU()
        --
        + forward(x): Tensor
    }
    
    class ResidualNeuralNetwork {
        - fc_in: Linear(input_size, hidden_size)
        - residual_blocks: List[ResidualBlock]
        - fc_out: Linear(hidden_size, output_size)
        - relu: ReLU()
        --
        + forward(x): Tensor
    }
    
    class AttentionLayer {
        - attention: Linear(hidden_size, hidden_size)
        - softmax: Softmax(dim=1)
        --
        + forward(x): Tensor
    }
    
    class AttentionNeuralNetwork {
        - fc1: Linear(input_size, hidden_size)
        - attention: AttentionLayer
        - fc2: Linear(hidden_size, output_size)
        - relu: ReLU()
        --
        + forward(x): Tensor
    }
    
    class TabNetModel {
        - model: TabNetClassifier
        --
        + predict(X): array
        + predict_proba(X): array
        + load_model(path): TabNetModel
    }
}

package "Model Management" {
    
    class ModelLoader {
        --
        + load_transaction_models(): tuple
        + load_budget_model(): TabNetModel
        + load_goal_model(): TabNetModel
        + load_flagged_model(): TabNetModel
    }
    
    class PredictionEngine {
        --
        + predict_transaction_type(features): dict
        + predict_budget_overrun(features): dict
        + predict_goal_success(features): dict
        + predict_flagged_transaction(features): dict
    }
}

package "Prediction Endpoints" {
    
    class AIAlertViewSet {
        + list(request): Response
        + create(request): Response
        + retrieve(request, pk): Response
    }
    
    class TransactionPredictionView {
        + predict_transaction_type(request): Response
    }
    
    class BudgetPredictionView {
        + predict_budget_risk(request): Response
    }
    
    class GoalPredictionView {
        + predict_goal_success(request): Response
    }
    
    class FraudPredictionView {
        + predict_flagged_transaction(request): Response
    }
}

ModelLoader --> DeepNeuralNetwork : loads
ModelLoader --> ResidualNeuralNetwork : loads
ModelLoader --> AttentionNeuralNetwork : loads
ModelLoader --> TabNetModel : loads

PredictionEngine --> ModelLoader : uses
PredictionEngine --> DeepNeuralNetwork : predicts with
PredictionEngine --> ResidualNeuralNetwork : predicts with
PredictionEngine --> AttentionNeuralNetwork : predicts with
PredictionEngine --> TabNetModel : predicts with

TransactionPredictionView --> PredictionEngine : calls
BudgetPredictionView --> PredictionEngine : calls
GoalPredictionView --> PredictionEngine : calls
FraudPredictionView --> PredictionEngine : calls

@enduml


' ============================================================================
'                      SEQUENCE DIAGRAMS
' ============================================================================

@startuml User_Registration_Flow

actor User
participant "Frontend\n(React)" as Frontend
participant "API Gateway" as API
participant "Accounts App" as Accounts
participant "UserSerializer" as Serializer
participant "User Model" as UserModel
database "MySQL" as DB

User -> Frontend: Fill registration form
Frontend -> Frontend: Validate form data

Frontend -> API: POST /api/accounts/register/\n{username, email, password, ...}
API -> Accounts: Forward request
Accounts -> Serializer: Validate data
Serializer -> Serializer: Check required fields
Serializer -> UserModel: Check email uniqueness
UserModel -> DB: SELECT * FROM users\nWHERE email = ?

alt Email exists
    DB --> UserModel: Email found
    UserModel --> Serializer: Email exists error
    Serializer --> Accounts: ValidationError
    Accounts --> API: 400 Bad Request
    API --> Frontend: Error response
    Frontend --> User: "Email already exists"
else Email available
    DB --> UserModel: No conflict
    Serializer -> UserModel: Create user instance
    UserModel -> UserModel: set_password(raw_password)\n[bcrypt hash]
    UserModel -> DB: INSERT INTO users\nVALUES (...)
    DB --> UserModel: User created
    UserModel --> Serializer: User object
    Serializer -> Serializer: Generate JWT token
    Serializer --> Accounts: Success + token
    Accounts --> API: 201 Created
    API --> Frontend: {user, token}
    Frontend -> Frontend: Store token in localStorage
    Frontend -> Frontend: Show success message
    Frontend -> Frontend: Wait 1.5s
    Frontend -> Frontend: window.location.href = '/login'
    Frontend --> User: Redirect to login page
end

@enduml


@startuml User_Login_Flow

actor User
participant "Frontend\n(React)" as Frontend
participant "API Gateway" as API
participant "Auth Strategy" as AuthContext
participant "Password Strategy" as PasswordAuth
participant "User Model" as UserModel
database "MySQL" as DB

User -> Frontend: Enter credentials\n(username/email + password)
Frontend -> Frontend: useEffect: Clear old errors

Frontend -> API: POST /api/accounts/login/\n{identifier, password}
API -> AuthContext: login_with_strategy(request)
AuthContext -> PasswordAuth: authenticate(identifier, password)

PasswordAuth -> UserModel: Find user by\nemail or username
UserModel -> DB: SELECT * FROM users\nWHERE email = ? OR username = ?

alt User found
    DB --> UserModel: User data
    UserModel --> PasswordAuth: User object
    PasswordAuth -> UserModel: check_password(password)
    UserModel -> UserModel: bcrypt.checkpw()
    
    alt Password correct
        UserModel --> PasswordAuth: True
        PasswordAuth -> PasswordAuth: Generate JWT token\n(7 day expiry)
        PasswordAuth --> AuthContext: {user, token}
        AuthContext --> API: 200 OK
        API --> Frontend: {user, token}
        Frontend -> Frontend: Store token
        Frontend -> Frontend: router.push('/dashboard')
        Frontend --> User: Show dashboard
    else Password incorrect
        UserModel --> PasswordAuth: False
        PasswordAuth --> AuthContext: Invalid credentials
        AuthContext --> API: 401 Unauthorized
        API --> Frontend: Error response
        Frontend --> User: "Invalid credentials"
    end
else User not found
    DB --> UserModel: No user
    UserModel --> PasswordAuth: User not found
    PasswordAuth --> AuthContext: Invalid credentials
    AuthContext --> API: 401 Unauthorized
    API --> Frontend: Error response
    Frontend --> User: "Invalid credentials"
end

@enduml


@startuml Transaction_Creation_Flow

actor User
participant "Frontend" as Frontend
participant "API Gateway" as API
participant "Transactions App" as TransApp
participant "Transaction Model" as TransModel
participant "Event Dispatcher" as EventDispatcher
participant "AI Observer" as AIObserver
participant "Fraud Observer" as FraudObserver
participant "Budget Observer" as BudgetObserver
database "MySQL" as DB

User -> Frontend: Create transaction\n(amount, type, merchant, date)
Frontend -> API: POST /api/transactions/\n{amount, type, merchant, ...}
API -> TransApp: Authenticated request

TransApp -> TransModel: Create transaction object
TransModel -> DB: INSERT INTO transactions
DB --> TransModel: Transaction created
TransModel -> TransModel: Save triggers post_save signal

TransModel -> EventDispatcher: Dispatch 'transaction_created' event
EventDispatcher -> AIObserver: notify(transaction_created, data)
AIObserver -> AIObserver: Categorize transaction\n(if no category)
AIObserver -> TransModel: Update category
TransModel -> DB: UPDATE transactions\nSET category_id = ?

EventDispatcher -> FraudObserver: notify(transaction_created, data)
FraudObserver -> FraudObserver: Check fraud patterns\n(amount, merchant, frequency)
alt Suspicious transaction
    FraudObserver -> TransModel: Flag as fraud
    TransModel -> DB: UPDATE transactions\nSET flagged_fraud = TRUE
    FraudObserver -> AIObserver: Create fraud alert
end

EventDispatcher -> BudgetObserver: notify(transaction_created, data)
BudgetObserver -> BudgetObserver: Check budget status
BudgetObserver -> DB: SELECT budget, SUM(transactions)
alt Budget exceeded
    BudgetObserver -> AIObserver: Create budget alert
    AIObserver -> DB: INSERT INTO ai_alerts
end

TransModel --> TransApp: Transaction object
TransApp --> API: 201 Created
API --> Frontend: Transaction data
Frontend --> User: Show success +\nrefresh transaction list

@enduml


@startuml AI_Prediction_Flow

actor User
participant "Frontend" as Frontend
participant "API Gateway" as API
participant "AI Alerts App" as AIApp
participant "Model Loader" as ModelLoader
participant "PyTorch Model" as Model
participant "TabNet Model" as TabNet
participant "Prediction Engine" as Engine
database "Model Store" as ModelStore

User -> Frontend: View AI insights
Frontend -> API: POST /api/ai-alerts/predict-budget-risk/\n{category, spent, budget, period}
API -> AIApp: Authenticated request

AIApp -> ModelLoader: load_budget_model()
ModelLoader -> ModelStore: torch.load('budget_tabnet.zip')
ModelStore --> ModelLoader: Model weights
ModelLoader -> TabNet: TabNet.load_model()
TabNet --> ModelLoader: Loaded model
ModelLoader --> AIApp: TabNet model

AIApp -> Engine: predict_budget_overrun(features)
Engine -> Engine: Feature engineering:\n- spent_ratio\n- days_into_period\n- avg_daily_spending
Engine -> TabNet: model.predict_proba(features)
TabNet -> TabNet: Forward pass through\nattention blocks
TabNet --> Engine: [risk_low, risk_high]
Engine -> Engine: Calculate risk score\nand recommendation
Engine --> AIApp: {risk: 0.85, recommendation: "..."}

AIApp --> API: 200 OK + prediction
API --> Frontend: Prediction data
Frontend --> User: Display risk meter\nand recommendations

@enduml


@startuml Budget_Calculation_Strategy

actor User
participant "Frontend" as Frontend
participant "API" as API
participant "Budgets App" as BudgetApp
participant "Budget Model" as Budget
participant "Calculation Context" as Context
participant "Strategy" as Strategy
database "MySQL" as DB

User -> Frontend: View budget details
Frontend -> API: GET /api/budgets/{id}/
API -> BudgetApp: Request budget

BudgetApp -> Budget: Get budget object
Budget -> DB: SELECT * FROM budgets WHERE id = ?
DB --> Budget: Budget data (period=MONTHLY, amount=1000)

Budget -> Budget: calculate_period_amount('WEEKLY')
Budget -> Context: New context with\nWeeklyBudgetCalculation()
Context -> Strategy: execute(monthly_amount=1000)
Strategy -> Strategy: Calculate: 1000 * 12 / 52
Strategy --> Context: 230.77
Context --> Budget: 230.77

Budget -> Budget: get_spending_status()
Budget -> DB: SELECT SUM(amount)\nFROM transactions\nWHERE category = ?\nAND date >= start_of_period
DB --> Budget: total_spent = 650
Budget -> Budget: Calculate:\n- remaining = 1000 - 650 = 350\n- percentage = (650/1000) * 100 = 65%

Budget --> BudgetApp: {\n  amount: 1000,\n  weekly: 230.77,\n  spent: 650,\n  remaining: 350,\n  percentage: 65\n}
BudgetApp --> API: Budget data
API --> Frontend: Response
Frontend --> User: Display budget chart\nwith spending progress

@enduml


@startuml Admin_User_Management

actor Admin
participant "Frontend\n(Admin Panel)" as Frontend
participant "API Gateway" as API
participant "Admin Panel App" as AdminApp
participant "Admin Model" as AdminModel
participant "User Model" as UserModel
participant "System Log" as SysLog
database "MySQL" as DB

Admin -> Frontend: Login to admin panel
Frontend -> API: POST /api/admin/auth/login/\n{email, password}
API -> AdminApp: Authenticate admin
AdminApp -> AdminModel: Find admin + verify password
AdminModel -> DB: SELECT * FROM admins
DB --> AdminModel: Admin data
AdminModel -> AdminModel: check_password()
AdminModel --> AdminApp: Admin + JWT token
AdminApp --> API: 200 OK
API --> Frontend: Admin authenticated
Frontend --> Admin: Show admin dashboard

Admin -> Frontend: Click "Manage Users"
Frontend -> API: GET /api/admin-panel/users/
API -> AdminApp: List all users
AdminApp -> UserModel: Query all users
UserModel -> DB: SELECT id, username, email,\nfirst_name, last_name, status\nFROM users
DB --> UserModel: User list
UserModel --> AdminApp: User objects
AdminApp --> API: Users array
API --> Frontend: User list
Frontend --> Admin: Display users table

Admin -> Frontend: Toggle user status\n(ACTIVE -> INACTIVE)
Frontend -> API: PATCH /api/admin-panel/users/{id}/\n{status: 'INACTIVE'}
API -> AdminApp: Update user status
AdminApp -> UserModel: Update user
UserModel -> DB: UPDATE users\nSET status = 'INACTIVE'\nWHERE id = ?
DB --> UserModel: Updated

AdminApp -> SysLog: Log admin action
SysLog -> DB: INSERT INTO system_logs\n(admin_id, action, details)
DB --> SysLog: Log created

UserModel --> AdminApp: Success
AdminApp --> API: 200 OK
API --> Frontend: User updated
Frontend --> Admin: Show success message +\nrefresh user list

@enduml


@startuml Plaid_Bank_Sync

actor User
participant "Frontend" as Frontend
participant "API Gateway" as API
participant "Bank Accounts App" as BankApp
participant "Plaid Client" as Plaid
participant "Plaid API" as PlaidAPI
participant "Transaction Model" as TransModel
database "MySQL" as DB

User -> Frontend: Click "Connect Bank"
Frontend -> API: POST /api/plaid/create-link-token/
API -> BankApp: Create link token
BankApp -> Plaid: plaid_client.link_token_create()
Plaid -> PlaidAPI: Create link token
PlaidAPI --> Plaid: link_token
Plaid --> BankApp: link_token
BankApp --> API: link_token
API --> Frontend: link_token
Frontend -> Frontend: Open Plaid Link UI
Frontend --> User: Select bank + login

User -> Frontend: Authorize bank connection
Frontend -> Frontend: Receive public_token
Frontend -> API: POST /api/plaid/exchange-token/\n{public_token}
API -> BankApp: Exchange token
BankApp -> Plaid: plaid_client.item_public_token_exchange()
Plaid -> PlaidAPI: Exchange token
PlaidAPI --> Plaid: access_token, item_id
Plaid --> BankApp: access_token, item_id

BankApp -> BankApp: encrypt_plaid_token(access_token)
BankApp -> DB: INSERT INTO bank_accounts\n(plaid_access_token, plaid_item_id, ...)
DB --> BankApp: Bank account created

BankApp -> BankApp: trigger_sync_transactions()
BankApp -> Plaid: plaid_client.transactions_sync()
Plaid -> PlaidAPI: Get transactions
PlaidAPI --> Plaid: transactions[]
Plaid --> BankApp: transactions[]

loop For each transaction
    BankApp -> TransModel: Create transaction
    TransModel -> DB: INSERT INTO transactions\n(source='SYNCED', ...)
    DB --> TransModel: Transaction created
end

BankApp -> DB: UPDATE bank_accounts\nSET last_sync = NOW()
DB --> BankApp: Updated

BankApp --> API: Sync complete
API --> Frontend: Success
Frontend --> User: "Bank connected!\nTransactions synced."

@enduml


' ============================================================================
'                          DEPLOYMENT ARCHITECTURE
' ============================================================================

@startuml Deployment_Architecture

node "Client Browser" {
    [Next.js Frontend]
    [React Components]
    [API Client (axios)]
}

node "Backend Server (localhost:8000)" {
    [Django 4.2.7]
    [Django REST Framework]
    [JWT Authentication]
    [Apps Layer]
    [Design Patterns]
    [Utils & Strategies]
}

node "AI/ML Server" {
    [PyTorch Runtime]
    [TabNet Engine]
    [Model Store]
    [.pth files]
    [.zip files]
}

node "Database Server" {
    database "MySQL 8.0" {
        [users]
        [transactions]
        [budgets]
        [goals]
        [loans]
        [categories]
        [bank_accounts]
        [ai_alerts]
        [admins]
        [system_logs]
    }
}

cloud "External Services" {
    [Plaid API]
}

[Next.js Frontend] --> [Django 4.2.7] : HTTP/REST
[Django 4.2.7] --> [MySQL 8.0] : MySQL Connector
[Apps Layer] --> [PyTorch Runtime] : Model Loading
[PyTorch Runtime] --> [Model Store] : Load .pth/.zip
[Django 4.2.7] --> [Plaid API] : HTTPS/REST
[Plaid API] --> [Django 4.2.7] : Webhooks

@enduml


' ============================================================================
'                          API ENDPOINTS OVERVIEW
' ============================================================================

@startuml API_Endpoints

package "Authentication" {
    [POST /api/accounts/register/] as Register
    [POST /api/accounts/login/] as Login
    [POST /api/admin/auth/login/] as AdminLogin
}

package "User Management" {
    [GET /api/accounts/profile/] as GetProfile
    [PUT /api/accounts/profile/] as UpdateProfile
    [PATCH /api/accounts/profile/] as PatchProfile
}

package "Transactions" {
    [GET /api/transactions/] as ListTrans
    [POST /api/transactions/] as CreateTrans
    [GET /api/transactions/{id}/] as GetTrans
    [PUT /api/transactions/{id}/] as UpdateTrans
    [DELETE /api/transactions/{id}/] as DeleteTrans
    [GET /api/transactions/statistics/] as TransStats
}

package "Budgets" {
    [GET /api/budgets/] as ListBudgets
    [POST /api/budgets/] as CreateBudget
    [GET /api/budgets/{id}/] as GetBudget
    [PUT /api/budgets/{id}/] as UpdateBudget
    [DELETE /api/budgets/{id}/] as DeleteBudget
}

package "Goals" {
    [GET /api/goals/] as ListGoals
    [POST /api/goals/] as CreateGoal
    [GET /api/goals/{id}/] as GetGoal
    [PUT /api/goals/{id}/] as UpdateGoal
    [DELETE /api/goals/{id}/] as DeleteGoal
}

package "Loans" {
    [GET /api/loans/] as ListLoans
    [POST /api/loans/] as CreateLoan
    [GET /api/loans/{id}/] as GetLoan
    [PUT /api/loans/{id}/] as UpdateLoan
    [DELETE /api/loans/{id}/] as DeleteLoan
}

package "Categories" {
    [GET /api/categories/] as ListCategories
    [POST /api/categories/] as CreateCategory
    [GET /api/categories/{id}/] as GetCategory
    [PUT /api/categories/{id}/] as UpdateCategory
    [DELETE /api/categories/{id}/] as DeleteCategory
}

package "Bank Accounts" {
    [GET /api/bank-accounts/] as ListBankAccounts
    [POST /api/bank-accounts/] as CreateBankAccount
    [GET /api/bank-accounts/{id}/] as GetBankAccount
    [DELETE /api/bank-accounts/{id}/] as DeleteBankAccount
}

package "Plaid Integration" {
    [POST /api/plaid/create-link-token/] as CreateLinkToken
    [POST /api/plaid/exchange-token/] as ExchangeToken
    [POST /api/plaid/sync-transactions/] as SyncTransactions
    [GET /api/plaid/accounts/] as GetPlaidAccounts
}

package "AI Predictions" {
    [POST /api/ai-alerts/predict-transaction-type/] as PredictTransType
    [POST /api/ai-alerts/predict-budget-risk/] as PredictBudgetRisk
    [POST /api/ai-alerts/predict-goal-success/] as PredictGoalSuccess
    [POST /api/ai-alerts/predict-flagged/] as PredictFlagged
    [GET /api/ai-alerts/] as ListAlerts
    [GET /api/ai-alerts/{id}/] as GetAlert
}

package "Admin Panel" {
    [GET /api/admin-panel/users/] as AdminListUsers
    [PATCH /api/admin-panel/users/{id}/] as AdminUpdateUser
    [GET /api/admin-panel/transactions/] as AdminListTrans
    [GET /api/admin-panel/system-info/] as SystemInfo
    [GET /api/admin-panel/logs/] as GetLogs
}

@enduml


' ============================================================================
'                       TECHNOLOGY STACK SUMMARY
' ============================================================================

@startuml Technology_Stack

package "Frontend" {
    component "Next.js 14.0.4" as NextJS
    component "React 18" as React
    component "TypeScript" as TS
    component "Tailwind CSS" as Tailwind
    component "Axios" as Axios
}

package "Backend" {
    component "Django 4.2.7" as Django
    component "Django REST Framework" as DRF
    component "Python 3.10+" as Python
    component "bcrypt" as Bcrypt
    component "PyJWT" as JWT
}

package "Database" {
    database "MySQL 8.0" as MySQL
}

package "AI/ML" {
    component "PyTorch 2.0+" as PyTorch
    component "pytorch-tabnet" as TabNet
    component "NumPy" as NumPy
    component "Pandas" as Pandas
}

package "External Services" {
    component "Plaid API" as Plaid
}

package "Security" {
    component "JWT Tokens" as JWTSec
    component "bcrypt Hashing" as BcryptSec
    component "Fernet Encryption" as Fernet
    component "CORS" as CORS
}

NextJS --> React : uses
NextJS --> TS : uses
NextJS --> Tailwind : styles
NextJS --> Axios : HTTP client

Django --> DRF : REST API
Django --> Python : runtime
Django --> Bcrypt : password hashing
Django --> JWT : authentication
Django --> MySQL : ORM

DRF --> PyTorch : AI integration
DRF --> TabNet : predictions
DRF --> Plaid : bank sync

Fernet --> MySQL : encrypt tokens

@enduml


' ============================================================================
'                    EVENT-DRIVEN ARCHITECTURE
' ============================================================================

@startuml Event_System

package "Event Types" {
    [transaction_created]
    [transaction_updated]
    [transaction_deleted]
    [budget_exceeded]
    [budget_warning]
    [goal_created]
    [goal_achieved]
    [loan_approved]
    [loan_rejected]
    [large_transaction]
    [fraud_detected]
}

package "Event Publishers" {
    [Transaction Model]
    [Budget Model]
    [Goal Model]
    [Loan Model]
}

package "Event Subscribers (Observers)" {
    [TransactionCategorizationObserver]
    [FraudDetectionObserver]
    [LargeTransactionObserver]
    [BudgetObserver]
    [GoalRecommendationObserver]
}

package "Side Effects" {
    [Create AI Alert]
    [Send Notification]
    [Update Statistics]
    [Log Action]
    [Flag Transaction]
}

[Transaction Model] --> [transaction_created] : publishes
[Transaction Model] --> [transaction_updated] : publishes
[Transaction Model] --> [transaction_deleted] : publishes
[Budget Model] --> [budget_exceeded] : publishes
[Budget Model] --> [budget_warning] : publishes
[Goal Model] --> [goal_created] : publishes
[Goal Model] --> [goal_achieved] : publishes
[Loan Model] --> [loan_approved] : publishes

[transaction_created] --> [TransactionCategorizationObserver] : notifies
[transaction_created] --> [FraudDetectionObserver] : notifies
[transaction_created] --> [LargeTransactionObserver] : notifies
[transaction_created] --> [BudgetObserver] : notifies

[budget_exceeded] --> [BudgetObserver] : notifies
[large_transaction] --> [LargeTransactionObserver] : notifies
[fraud_detected] --> [FraudDetectionObserver] : notifies

[TransactionCategorizationObserver] --> [Update Statistics] : triggers
[FraudDetectionObserver] --> [Create AI Alert] : triggers
[FraudDetectionObserver] --> [Flag Transaction] : triggers
[LargeTransactionObserver] --> [Create AI Alert] : triggers
[BudgetObserver] --> [Create AI Alert] : triggers
[BudgetObserver] --> [Send Notification] : triggers

@enduml


' ============================================================================
'                           DATA FLOW DIAGRAM
' ============================================================================

@startuml Data_Flow

actor "User" as User
actor "Admin" as Admin

rectangle "Frontend Layer" {
    [UI Components]
    [State Management]
    [API Client]
}

rectangle "Backend Layer" {
    [API Routes]
    [ViewSets]
    [Serializers]
    [Models]
    [Signals]
}

rectangle "Business Logic" {
    [Design Patterns]
    [Observers]
    [Strategies]
    [Event System]
}

rectangle "AI Layer" {
    [Model Loader]
    [Prediction Engine]
    [Feature Engineering]
}

database "Data Storage" {
    [User Data]
    [Transactions]
    [Financial Goals]
    [AI Models]
}

User --> [UI Components] : interacts
Admin --> [UI Components] : manages

[UI Components] --> [State Management] : updates
[State Management] --> [API Client] : requests
[API Client] --> [API Routes] : HTTP/REST

[API Routes] --> [ViewSets] : handles
[ViewSets] --> [Serializers] : validates
[Serializers] --> [Models] : CRUD operations

[Models] --> [Data Storage] : persists
[Models] --> [Signals] : triggers

[Signals] --> [Event System] : publishes events
[Event System] --> [Observers] : notifies
[Observers] --> [Design Patterns] : executes
[Observers] --> [AI Layer] : requests predictions

[AI Layer] --> [AI Models] : loads
[AI Layer] --> [Feature Engineering] : processes
[Prediction Engine] --> [Models] : updates with predictions

[Data Storage] --> [Models] : retrieves
[Models] --> [Serializers] : formats
[Serializers] --> [ViewSets] : returns
[ViewSets] --> [API Routes] : responds
[API Routes] --> [API Client] : JSON
[API Client] --> [State Management] : updates
[State Management] --> [UI Components] : renders
[UI Components] --> User : displays

@enduml


@endstartuml

================================================================================
                              END OF UML DIAGRAMS
================================================================================

SUMMARY OF SYSTEM ARCHITECTURE:
--------------------------------

1. FRONTEND ARCHITECTURE (Next.js/React)
   - Pages: Login, Register, Dashboard, Transactions, Budgets, Goals, Loans, Admin Panel
   - Components: Reusable UI components with Tailwind CSS
   - State Management: React hooks (useState, useEffect, useContext)
   - API Client: Axios with JWT token interceptors
   - Routing: Next.js App Router
   - Authentication: JWT tokens stored in localStorage

2. BACKEND ARCHITECTURE (Django REST Framework)
   - Apps: accounts, transactions, budgets, goals, loans, categories, bank_accounts, 
           ai_alerts, admin_panel, chatbot, funder
   - Authentication: JWT-based with 7-day expiry, bcrypt password hashing
   - Design Patterns: Observer, Strategy, Singleton, Event-Driven Architecture
   - API: RESTful endpoints with ViewSets
   - ORM: Django ORM with MySQL

3. DATABASE SCHEMA (MySQL)
   - Users & Auth: users, admins tables
   - Financial Data: transactions, budgets, goals, loans, categories, bank_accounts
   - AI & Monitoring: ai_alerts, system_logs, admin_actions
   - Relationships: Foreign keys with CASCADE/SET_NULL deletion
   - Constraints: Unique constraints, CHECK constraints for data integrity

4. AI/ML LAYER (PyTorch & TabNet)
   - Models: DeepNeuralNetwork, ResidualNeuralNetwork, AttentionNeuralNetwork, TabNet
   - Predictions: Transaction categorization, budget risk, goal success, fraud detection
   - Model Storage: .pth and .zip files in model_store directory
   - Real-time Inference: Loaded models used for live predictions

5. EXTERNAL INTEGRATIONS
   - Plaid API: Bank account connection, transaction sync, balance retrieval
   - Encryption: Fernet encryption for sensitive tokens

6. DESIGN PATTERNS IMPLEMENTED
   - Observer Pattern: Event-driven transaction processing
   - Strategy Pattern: Calculation strategies for interest and budgets
   - Singleton Pattern: Global performance cache
   - Event Dispatcher: Centralized event management

7. SECURITY FEATURES
   - Password Hashing: bcrypt with salt
   - Token Encryption: Fernet symmetric encryption
   - JWT Authentication: 7-day expiry, secure token storage
   - CORS: Configured for cross-origin requests
   - SQL Injection Prevention: Django ORM parameterized queries

8. KEY WORKFLOWS
   - User Registration: Form validation → API call → Password hashing → JWT generation
   - User Login: Credential validation → bcrypt check → JWT issuance → Dashboard redirect
   - Transaction Creation: Insert → Trigger signals → Event dispatch → Observer notifications
   - AI Prediction: Feature extraction → Model loading → Inference → Result formatting
   - Budget Tracking: Strategy pattern for period calculations → Spending status checks
   - Admin Management: Separate authentication → User/transaction management → System logs

9. DEPLOYMENT CONFIGURATION
   - Frontend: Next.js dev server on localhost:3001
   - Backend: Django runserver on localhost:8000
   - Database: MySQL 8.0 local instance
   - Models: Local model_store directory

10. API STRUCTURE
    - Authentication: /api/accounts/register/, /api/accounts/login/
    - Resources: /api/transactions/, /api/budgets/, /api/goals/, /api/loans/
    - AI: /api/ai-alerts/predict-*/
    - Admin: /api/admin-panel/*
    - Plaid: /api/plaid/*

================================================================================
